---
layout: post
title: pi2go Is working 100%
date: '2013-06-04T12:25:00.001-07:00'
author: Daryl Bennett
tags:
- pi2go
- RPi
- Pi
- linux
- Python
- QT
modified_time: '2013-11-24T19:27:12.506-08:00'
thumbnail: http://1.bp.blogspot.com/-eQ9N7vNKH94/Ua4wP-QsYqI/AAAAAAAAEUg/Fc8UPi9Ne2Y/s72-c/splash.png
blogger_id: tag:blogger.com,1999:blog-7621217468312732627.post-2489604837788540944
blogger_orig_url: http://kd8bny.blogspot.com/2013/06/pi2go-is-working-100.html
---

For those that may like an update on how well pi2go is working. Well the answer is quite well actually. For this reason I will walk you through its functionality and how it works. pi2go Is written in python 2.7 utilizing pyQt4 and pySerial for Raspberry Pi. It is being created as an easy UI for a vehicle computer. So far the only feature is reading engine information from the OBDII sensor via Bluetooth.<br /><br />First off in Figure 1 below &nbsp;displays the given start screen.<br /><div class="separator" style="clear: both; text-align: center;"></div><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://1.bp.blogspot.com/-eQ9N7vNKH94/Ua4wP-QsYqI/AAAAAAAAEUg/Fc8UPi9Ne2Y/s1600/splash.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="228" src="http://1.bp.blogspot.com/-eQ9N7vNKH94/Ua4wP-QsYqI/AAAAAAAAEUg/Fc8UPi9Ne2Y/s320/splash.png" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Figure 1</td></tr></tbody></table><div class="separator" style="clear: both; text-align: center;"></div>As stated in a previous post I would like to place a clock in the blank space on the right. Before I attempt that I need a little more info on QThreads. Pressing the "OBDII" tab will bring up the OBDII scanning feature displayed in Figure 2 below.<br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-lzi0dfVMjos/Ua4xt_oq3xI/AAAAAAAAEU8/7V3rCjmIV9Q/s1600/OBD+blank.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="228" src="http://2.bp.blogspot.com/-lzi0dfVMjos/Ua4xt_oq3xI/AAAAAAAAEU8/7V3rCjmIV9Q/s320/OBD+blank.png" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Figure 2</td></tr></tbody></table>These are the current engine stats that are being read. Currently the values are updated every 1sec, I will be adding selector so this value can be changed to personal preference. Pressing the display "Start" button will initialize the scanning thread. (Thats right this python novice introduced multithreading.) This simply mean the background process is taking place outside the main program so it does not slow itself down.<br /><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">obdThread = Thread(target=self.write_to_UI(obdValue), args =   (self,obdValue))</span>&nbsp;</blockquote><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">obdEvent = Event()<br /> </span><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">obdThread.start()</span></blockquote>Figure 3 and 4 below display the running program.<br /><table cellpadding="0" cellspacing="0" class="tr-caption-container" style="float: right; margin-left: 1em; text-align: right;"><tbody><tr><td style="text-align: center;"><a href="http://1.bp.blogspot.com/-1KBH0nt3yJ8/Ua5WfZBDBCI/AAAAAAAAEVs/eFmNPtLdUmg/s1600/run.png" imageanchor="1" style="clear: right; margin-bottom: 1em; margin-left: auto; margin-right: auto;"><img border="0" height="225" src="http://1.bp.blogspot.com/-1KBH0nt3yJ8/Ua5WfZBDBCI/AAAAAAAAEVs/eFmNPtLdUmg/s320/run.png" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Figure 4</td></tr></tbody></table><br /><table cellpadding="0" cellspacing="0" class="tr-caption-container" style="float: left; margin-right: 1em; text-align: left;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-agqPy1cxBck/Ua4wP2ivR6I/AAAAAAAAEUk/A1uda8D839U/s1600/clivalues.png" imageanchor="1" style="clear: left; margin-bottom: 1em; margin-left: auto; margin-right: auto;"><img border="0" height="115" src="http://4.bp.blogspot.com/-agqPy1cxBck/Ua4wP2ivR6I/AAAAAAAAEUk/A1uda8D839U/s200/clivalues.png" width="200" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Figure 3 &nbsp;</td></tr></tbody></table><div class="separator" style="clear: both; text-align: center;"></div>Above Figure 3 displays information as it comes in, before it is updated on Figure 4.<br /><div><div><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">def write_to_UI(self,values):</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span" style="white-space: pre;">  </span>"""Updates the UI with new values"""</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span" style="white-space: pre;">  </span># receive [speed, rpm, intake, coolant, load]</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span" style="white-space: pre;">  </span>self.ui.lcdNumber_speed.display(values[0])</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span" style="white-space: pre;">  </span>self.ui.lcdNumber_rpm.display(values[1])</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span" style="white-space: pre;">  </span>self.ui.lcdNumber_inTemp.display(values[2])</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span" style="white-space: pre;">  </span>self.ui.lcdNumber_coolTemp.display(values[3])</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span" style="white-space: pre;">  </span>self.ui.lcdNumber_load.display(values[4])</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span" style="white-space: pre;">  </span>QtGui.QApplication.processEvents() #Writes all pending changes to QT</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span" style="white-space: pre;">  </span>return</span></blockquote><div>The guts behind the scanning thread is all in pySerial. The code below show how the scanner obtains values from the OBDII sensor. This example is the speed however the method is the same for all.<br /><br />First a serial port is connected, "rfcomm0" at a baud rate of "38400".<br /><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">self.serialIO = serial.Serial('/dev/rfcomm0', 38400, timeout=1)</span></blockquote>Then using the serialport you send send a hexadecimal PID which can be found <a href="http://en.wikipedia.org/wiki/OBD-II_PIDs" target="_blank">here</a>. In this case we send "01", "0D" and want a return "\r". ("01" stands for the current value, "0D" is speed.)<br /><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">self.serialIO.write("01 0D \r")</span></blockquote>The above line will return a list of 1 string "['410D<b>1D</b>\r\r&gt;']" not including quotes. The bold values are what is needed. They are a hexadecimal value so the code below first pulls the needed values by treating the string as a list. Then converts (Using the example) from a string, '<b>1D</b>'<b>,</b>&nbsp;to hex value '<b>0x1D</b>' to an integer, base zero, <b>29</b>&nbsp;to a float <b>29.0 </b>The final answer being in Kph<br />(I apologize for that long run on sentence I hope you were able to follow)<br /><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">speed_list = self.serialIO.readline().split(' ')<br />speed_hex = speed_list[0][4:6]<br /> speed_float = float(int("0x"+speed_hex, 0))</span>&nbsp;</blockquote>I then converted the value to Mph and returned it in a list with other values.<br /><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">speed_float = speed_float*0.621371 #Comment out if you would rather have Kph<br /> return speed_float</span></blockquote>The last feature I added in this version is the ability to clear error codes. It is placed in the setting tab as depicted in Figure 5.<br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-XPNj2qju-OY/Ua4-IkhWrkI/AAAAAAAAEVc/AkFrKg3ZzUQ/s1600/clear.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="228" src="http://4.bp.blogspot.com/-XPNj2qju-OY/Ua4-IkhWrkI/AAAAAAAAEVc/AkFrKg3ZzUQ/s320/clear.png" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Figure 5</td></tr></tbody></table><div class="separator" style="clear: both; text-align: left;">This tab will have more options evenly and will have feedback to the clearing function.</div><br />------------------------------------------------------------------------------------------------------------------------------<br />There you have it the basic functionality of pi2go and how it works. Any feedback will be outstanding!<br />As always if you would like to follow/keep up on this blog or check out <a href="https://github.com/kd8bny/pi2go" target="_blank">github</a>. I have many new features to add.<br /><br />**For those that care written in Python2.7 utilizing pyQt4 over pySerial. <a href="https://github.com/kd8bny/pi2go/issues" target="_blank">Issue tracker</a></div></div></div>